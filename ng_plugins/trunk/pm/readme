# =========================================================================== #
# NG CMS // Плагины // Личные сообщения                                       #
# =========================================================================== #

Плагин реализует возможность обмена приватными сообщениями между 
зарегистрированными пользователями на вашем сайте.

Функции
----------------------------------------
- отправка сообщений
- удаление сообщений
- папки Входящие и Исходящие
- уведомление о приходе нового сообщения
- поддержка BB-кодов

Как установить?
----------------------------------------
- Закачать папку с плагином в каталог /engine/plugins/
- Установить плагин в админ-панели в разделе Плагины
- Включить плагин в админ-панели в разделе Плагины 

Как это работает?
----------------------------------------
После активации плагина вам становятся доступны личные сообщения по адресу /plugin/pm/

Что мне нужно добавить в шаблоны?
----------------------------------------
usermenu.tpl
  + {{ p.pm.pm_unread }} - кол-во новых входящих сообщений
  + {{ p.pm.pm_all }} - общее кол-во входящих сообщений
  + {{ p.pm.link }} - URL на страницу со входящими сообщениями

Пример заполнения шаблона usermenu.tpl:
--cut--
{% if p.pm.new > 0 %}<a href="{{ p.pm.link }}">Новые сообщения: {{ p.pm.new }}</a> / {% endif %} {{ p.pm.total }}
--cut--


/plugins/uprofile/users.tpl
   
  Плагин умеет подставлять в поле получателя его ник, если задать его в URL ?action=write&name=nickname
  Чтобы добавить полезную ссылку "Отправить сообщение" в профиле пользователя в шаблон можно вписать
  вот такой код: <a href="/plugin/pm/?action=write&name={user}">[Отправить сообщение]</a>
  
Как мне изменить оформление плагина?
----------------------------------------
Все оформление содержится в .TPL и .CSS файлах. Там все можно подогнать под свой стиль сайта, все же я не дизайнер-верстальщик.
 
Шаблоны плагина
----------------------------------------
* entries.tpl — строка входящего сообщения
	- pmdate - дата и время отправки сообщения
	- php_self - ссылка на страницу плагина вида site.ru/plugin/pm/
	- pmid - ID сообщения в БД
	- subject - тема письма
	- link - ссылка на отправителя письма
	- viewed - изображение статуса письма, viewed.yes.gif и viewed.no.gif

* inbox.tpl — контейнер входящих сообщений

	- php_self - ссылка на страницу плагина вида site.ru/plugin/pm/
	- entries - список писем, формируемый из entries.tpl
	- pagination - навигация по страницам, она же пагинация

* outbox_entries.tpl — строка исходящего сообщения

	- pmdate - дата и время отправки сообщения
	- php_self - ссылка на страницу плагина вида site.ru/plugin/pm/
	- pmid - ID сообщения в БД
	- subject - тема письма
	- link - ссылка на отправителя письма

* outbox.tpl — контейнер исходящих сообщений

	- php_self - ссылка на страницу плагина вида site.ru/plugin/pm/
	- entries - список писем, формируемый из entries.tpl
	- pagination - навигация по страницам, она же пагинация

* read.tpl — форма чтения сообщения

	- php_self - ссылка на страницу плагина вида site.ru/plugin/pm/
	- subject - тема письма
	- pmid - ID сообщения в БД
	- location - принимает значение inbox или outbox
	- pmdate - дата и время отправки сообщения
	- content - текст сообщения
	- author - ссылка на получателя/отправителя

Также в шаблоне доступны две условные конструкции if-inbox и if-outbox, 
текст между которыми доступен если сообщение входящее или исходящее.

* reply.tpl — форма ответа на сообщение

	- php_self - ссылка на страницу плагина вида site.ru/plugin/pm/
	- title - тема письма + Re
	- pmid - ID сообщения в БД
	- to_username - ID отправителя из таблицы users
	- quicktags - форма с BB-тегами
	- smiles - фома со смайлами

* write.tpl — форма написания нового сообщения

	- php_self - ссылка на страницу плагина вида site.ru/plugin/pm/
	- username - имя получателя
	- quicktags - форма с BB-тегами
	- smiles - фома со смайлами
 
Как выразить благодарность за плагин?
----------------------------------------
Яндекс.Деньги: 41001246158060
WebMoney: R128203457262 или Z185759217217